digraph MIR_Optimization_Pipeline {
    rankdir=TB;
    node [shape=box, style="filled,rounded", fontname="Arial", fontsize=10, fillcolor="#f9f9f9", color="#333333"];
    edge [color="#666666", penwidth=1.2];

    MIR [shape=ellipse, fillcolor="#e1f5fe", label="MIR IR"];
    MachineCode [shape=ellipse, fillcolor="#fff3e0", label="Native Machine Code"];

    subgraph cluster_frontend {
        label = "Frontend / Core";
        style = dashed;
        color = "#cccccc";
        Simplify [label="Simplify\n(Lowering MIR)", fillcolor="#e8f5e9", URL="19_mir_implementation.html#the-simplifier-s-toolbox-simplify-func"];
    }

    subgraph cluster_middle_end {
        label = "Optimizer (Middle-End)";
        style = dashed;
        color = "#cccccc";
        
        BuildCFG [label="Build CFG", URL="#the-architect-s-blueprint-build-func-cfg"];
        BuildSSA [label="Build SSA", URL="#the-single-truth-ssa-construction"];
        AddrTrans [label="Address\nTransformation", URL="#from-abstract-to-concrete-address-transformation"];
        BlockCloning [label="Block Cloning", URL="#path-specialization-basic-block-cloning"];
        
        subgraph cluster_ssa_opts {
            label = "SSA Optimizations";
            fillcolor="#fafafa";
            GVN [label="GVN / CP / RLE", URL="#the-grand-library-global-value-numbering-gvn"];
            CopyProp [label="Copy Propagation", URL="#the-vanishing-act-copy-propagation"];
            DSE [label="Dead Store\nElimination", URL="#cleaning-the-warehouses-dead-store-elimination-dse"];
            DCE1 [label="Dead Code\nElimination"];
            LICM [label="Loop Invariant\nMotion", URL="#escaping-the-loop-loop-invariant-code-motion-licm"];
        }
        
        PressureRelief [label="Pressure Relief"];
        SSACombine [label="SSA Combine", URL="#the-merging-pass-instruction-combining-ssa-combine"];
        OutSSA [label="Out of SSA", URL="#the-final-handover-conventional-ssa-make-conventional-ssa"];
        JumpOpts [label="Jump Opts", URL="#the-path-smoother-jump-optimization-jump-opt"];
    }

    subgraph cluster_backend {
        label = "Backend (Target-Specific)";
        style = dashed;
        color = "#cccccc";
        
        Machinize [label="Machinize", fillcolor="#fff9c4", URL="#handover-to-the-metal-target-translation"];
        BuildLive [label="Build Live Info", URL="#mapping-existence-live-range-analysis"];
        BuildConflicts [label="Build Register\nConflicts", URL="#aggressive-register-coalescing-coalesce"];
        Coalesce [label="Coalesce"];
        RA [label="Register Allocator\n(Priority Linear Scan)", fillcolor="#ffebee", URL="#the-allocation-war-linear-scan-ra"];
        Combine [label="Combine\n(Code Selection)"];
        DCE2 [label="Dead Code\nElimination"];
        GenMachine [label="Generate Machine\nInstructions", fillcolor="#fff9c4"];
    }

    MIR -> Simplify;
    Simplify -> BuildCFG;
    BuildCFG -> BuildSSA;
    BuildSSA -> AddrTrans;
    AddrTrans -> BlockCloning;
    BlockCloning -> GVN;
    GVN -> CopyProp;
    CopyProp -> DSE;
    DSE -> DCE1;
    DCE1 -> LICM;
    LICM -> PressureRelief;
    PressureRelief -> SSACombine;
    SSACombine -> OutSSA;
    OutSSA -> JumpOpts;
    JumpOpts -> Machinize;
    Machinize -> BuildLive;
    BuildLive -> BuildConflicts;
    BuildConflicts -> Coalesce;
    Coalesce -> RA;
    RA -> Combine;
    Combine -> DCE2;
    DCE2 -> GenMachine;
    GenMachine -> MachineCode;
}
